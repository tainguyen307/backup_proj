<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
<meta charset="UTF-8" />
<title>Xác minh OTP - WOMTech</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- CSRF cho JS (resend) - chỉ render khi có -->
<th:block th:if="${_csrf != null}">
	<meta name="_csrf" th:content="${_csrf.token}">
	<meta name="_csrf_header" th:content="${_csrf.headerName}">
</th:block>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
	rel="stylesheet">
<link th:href="@{/css/auth/verify-otp.css}" rel="stylesheet" />
</head>
<body class="bg-light">

	<main
		class="container d-flex flex-column justify-content-center align-items-center min-vh-75 py-5">
		<div class="card shadow-sm otp-card">
			<div class="card-body p-4 p-md-5 text-center">

				<div class="mb-3">
					<i class="bi bi-shield-lock fs-1"></i>
				</div>
				<h1 class="h4 mb-2">Xác minh mã OTP</h1>
				<p class="text-muted mb-4">
					Một mã gồm 6 chữ số đã được gửi tới <strong
						th:text="${maskedEmail ?: 'email của bạn'}">email của bạn</strong>.
				</p>

				<div th:if="${error}" class="alert alert-danger py-2"
					th:text="${error}">Mã không đúng hoặc đã hết hạn.</div>
				<div th:if="${success}" class="alert alert-success py-2"
					th:text="${success}">Thành công!</div>

				<form th:action="@{/auth/verify-otp}" method="post" id="otpForm"
					class="mx-auto" style="max-width: 560px;">

					<!-- CSRF hidden input (chỉ render khi có) -->
					<th:block th:if="${_csrf != null}">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
					</th:block>

					<!-- Nhóm ô OTP -->
					<div class="otp-group d-flex gap-2 justify-content-center mb-3"
						id="otpGroup" aria-label="Nhập mã OTP gồm 6 số">
						<input class="otp-input" type="text" inputmode="numeric"
							pattern="[0-9]*" maxlength="1" autocomplete="one-time-code"
							aria-label="Số 1"> <input class="otp-input" type="text"
							inputmode="numeric" pattern="[0-9]*" maxlength="1"
							autocomplete="one-time-code" aria-label="Số 2"> <input
							class="otp-input" type="text" inputmode="numeric"
							pattern="[0-9]*" maxlength="1" autocomplete="one-time-code"
							aria-label="Số 3"> <input class="otp-input" type="text"
							inputmode="numeric" pattern="[0-9]*" maxlength="1"
							autocomplete="one-time-code" aria-label="Số 4"> <input
							class="otp-input" type="text" inputmode="numeric"
							pattern="[0-9]*" maxlength="1" autocomplete="one-time-code"
							aria-label="Số 5"> <input class="otp-input" type="text"
							inputmode="numeric" pattern="[0-9]*" maxlength="1"
							autocomplete="one-time-code" aria-label="Số 6">
					</div>

					<input type="hidden" name="otp" id="otpHidden" />

					<button class="btn btn-primary w-100 mb-3" type="submit"
						id="submitBtn" disabled>Xác minh</button>

					<div class="small text-muted">
						<span>Chưa nhận được mã?</span>
						<button class="btn btn-link p-0 align-baseline" type="button"
							id="resendBtn" disabled
							th:data-remaining="${remainingSeconds ?: 60}">
							Gửi lại (<span id="countdown">60</span>s)
						</button>
					</div>

					<div class="form-text mt-3">
						Mẹo: Bạn có thể <strong>dán</strong> trực tiếp mã 6 số vào bất kỳ
						ô nào.
					</div>
				</form>
			</div>
		</div>
	</main>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script th:src="@{/js/auth/verify-otp.js}"></script>
</body>
</html>
