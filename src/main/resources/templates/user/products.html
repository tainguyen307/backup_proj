<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout}">

<head>
    <meta charset="UTF-8">
    <title>Sản phẩm - WOMTech</title>
    <link rel="stylesheet" th:href="@{/css/user/products.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script th:src="@{/js/user/favorite.js}"></script>
</head>

<body>
<div layout:fragment="content" class="container py-5">

    <!-- PAGE TITLE -->
    <div class="text-center mb-5">
        <h1 class="fw-bold text-primary">Sản Phẩm</h1>
        <p class="text-muted">Khám phá những sản phẩm mới nhất và được yêu thích nhất tại WOMTech</p>
    </div>

    <div class="row">
        <!-- SIDEBAR: FILTER -->
        <div class="col-md-3 mb-4">
            <div class="card shadow-sm border-0 p-3">
                <h5 class="fw-bold mb-3">Danh Mục</h5>
                <ul class="list-group list-group-flush category-list">
					<li th:each="cat : ${categories}"
						class="list-group-item p-0 border-0"><a
						th:href="@{/products(category=${cat.categoryID})}"
						class="d-flex justify-content-between align-items-center text-decoration-none text-dark px-3 py-2 category-link">
							<span th:text="${cat.name}"></span> <i
							class="fas fa-chevron-right small text-muted"></i>
					</a></li>
				</ul>

                <hr class="my-4">

                <h5 class="fw-bold mb-3">Sắp xếp</h5>
                <form method="get" th:action="@{/products}">
                    <select class="form-select" name="sort" onchange="this.form.submit()">
                        <option value="">Mặc định</option>
                        <option value="latest" th:selected="${selectedSort == 'latest'}">Mới nhất</option>
                        <option value="priceAsc" th:selected="${selectedSort == 'priceAsc'}">Giá tăng dần</option>
                        <option value="priceDesc" th:selected="${selectedSort == 'priceDesc'}">Giá giảm dần</option>
                        <option value="popular" th:selected="${selectedSort == 'popular'}">Bán chạy</option>
                        <option value="favorite" th:selected="${selectedSort == 'favorite'}">Yêu thích</option>
                    </select>
                    <input type="hidden" name="category" th:value="${selectedCategory}">
                </form>
            </div>
        </div>

        <!-- MAIN: PRODUCT GRID -->
        <div class="col-md-9">
            <div class="row g-4">
                <div class="col-md-4 col-lg-3" th:each="product : ${products.content}">
                    <div class="card product-card h-100 border-0 shadow-sm">
                        <div class="position-relative">
                            <a th:href="@{/product/{id}(id=${product.productID})}">
                                <img th:src="${product.thumbnail}" alt="Product" class="card-img-top product-image img-fluid">
                            </a>

                            <!-- DISCOUNT BADGE -->
                            <div class="badge bg-danger position-absolute top-0 start-0 m-2"
                                 th:if="${product.discount_price != null and product.discount_price > 0}"
                                 th:text="'-' + ${T(java.lang.Math).round((1 - product.discount_price.doubleValue() / product.price.doubleValue()) * 100)} + '%'">
                            </div>

                            <!-- FAVORITE BUTTON -->
                            <button class="btn btn-light position-absolute top-0 end-0 m-2 favorite-btn"
                                    th:data-id="${product.productID}">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>

                        <div class="card-body d-flex flex-column">
                            <h6 class="fw-bold text-dark mb-1" th:text="${product.name}">Tên sản phẩm</h6>
                            <small class="text-muted mb-2" th:text="${product.brand.name}">Thương hiệu</small>

                            <!-- PRICE -->
                            <div class="mt-auto">
                                <span class="fw-bold text-primary"
                                      th:text="${#numbers.formatDecimal(
                                                      (product.discount_price != null and product.discount_price > 0) ?
                                                      product.discount_price : product.price,
                                                      0, 'COMMA', 0, 'POINT')} + ' VNĐ'">
                                </span>

                                <div class="text-muted small"
                                     th:if="${product.discount_price != null and product.discount_price > 0}">
                                    <del th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></del>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer bg-white border-0 text-center">
                            <a th:href="@{/product/{id}(id=${product.productID})}"
                               class="btn btn-sm btn-outline-primary w-100">
                                <i class="fas fa-eye me-1"></i> Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGINATION -->
            <nav class="mt-5" th:if="${products.totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <!-- Previous -->
					<li class="page-item" th:classappend="${products.first}? 'disabled'">
					    <a class="page-link"
					       th:href="@{/products(page=${products.number > 0 ? products.number - 1 : 0},
					                            sort=${selectedSort},
					                            category=${selectedCategory},
					                            ids=${param.ids})}">Trước</a>
					</li>
					
					<!-- Page numbers -->
					<li th:each="pageNum : ${#numbers.sequence(0, products.totalPages - 1)}"
					    class="page-item"
					    th:classappend="${pageNum == products.number}? 'active'">
					    <a class="page-link"
					       th:text="${pageNum + 1}"
					       th:href="@{/products(page=${pageNum},
					                            sort=${selectedSort},
					                            category=${selectedCategory},
					                            ids=${param.ids})}"></a>
					</li>
					
					<!-- Next -->
					<li class="page-item" th:classappend="${products.last}? 'disabled'">
					    <a class="page-link"
					       th:href="@{/products(page=${products.number < products.totalPages - 1 ? products.number + 1 : products.totalPages - 1},
					                            sort=${selectedSort},
					                            category=${selectedCategory},
					                            ids=${param.ids})}">Sau</a>
					</li>
                </ul>
            </nav>
        </div>
    </div>
</div>
</body>
</html>
