<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{user/layout}">

<head>
<meta charset="UTF-8">
<title>Giỏ hàng - WOMTech</title>

<th:block layout:fragment="css">
	<!-- Custom CSS -->
	<link th:href="@{/css/user/cart.css}" rel="stylesheet">
	<!-- Bootstrap Icons -->
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
		rel="stylesheet">
</th:block>
</head>

<body>
	<div layout:fragment="content">

		<!-- BREADCRUMB -->
		<section class="bg-light py-3 border-bottom">
			<div class="container">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb mb-0">
						<li class="breadcrumb-item"><a th:href="@{/}">Trang chủ</a></li>
						<li class="breadcrumb-item active" aria-current="page">Giỏ
							hàng</li>
					</ol>
				</nav>
			</div>
		</section>

		<!-- CART SECTION -->
		<section class="container py-5">
			<h2 class="text-center mb-4 fw-bold">
				<i class="bi bi-cart-check text-primary me-2"></i>Giỏ hàng của bạn
			</h2>

			<!-- Giỏ hàng trống -->
			<div th:if="${#lists.isEmpty(cart.items)}"
				class="text-center py-5 text-muted">
				<i class="bi bi-bag-x fs-1 mb-3"></i>
				<h5>Giỏ hàng của bạn đang trống.</h5>
				<a th:href="@{/products}" class="btn btn-primary mt-3"> <i
					class="bi bi-arrow-right-circle me-1"></i>Tiếp tục mua sắm
				</a>
			</div>

			<!-- Giỏ hàng có sản phẩm -->
			<div th:if="${!#lists.isEmpty(cart.items)}" class="row g-4">
				<div class="col-lg-8">
					<div class="card shadow-sm border-0">
						<div class="card-body p-0">
							<table class="table align-middle mb-0">
								<thead class="table-light">
									<tr class="text-center">
										<th style="width: 120px;">Sản phẩm</th>
										<th class="text-start">Tên</th>
										<th>Giá</th>
										<th style="width: 160px;">Số lượng</th>
										<th>Tổng</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="item : ${cart.items}"
										class="text-center align-middle">
										<!-- Ảnh -->
										<td style="width: 100px;"><img
											th:src="${item.product.thumbnail}"
											th:alt="${item.product.name}"
											class="img-fluid rounded shadow-sm" style="width: 90px;">
										</td>

										<!-- Tên -->
										<td class="text-start px-3"><a
											th:href="@{/product/{id}(id=${item.product.productID})}"
											class="fw-semibold text-dark text-decoration-none"
											th:text="${item.product.name}">Tên sản phẩm</a></td>

										<!-- Giá -->
										<td class="text-end px-3"><span
											class="text-primary fw-bold d-block"
											th:text="${item.product.discount_price != null and item.product.discount_price.compareTo(T(java.math.BigDecimal).ZERO) > 0 ? 
													#numbers.formatDecimal(item.product.discount_price, 0, 'COMMA', 0, 'POINT') + '₫' : 
													#numbers.formatDecimal(item.product.price, 0, 'COMMA', 0, 'POINT') + '₫'}">
										</span> <del class="text-muted small d-block mt-1"
												th:if="${item.product.discount_price != null and item.product.discount_price.compareTo(T(java.math.BigDecimal).ZERO) > 0}"
												th:text="${#numbers.formatDecimal(item.product.price, 0, 'COMMA', 0, 'POINT')} + '₫'">
											</del></td>

										<!-- Số lượng -->
										<td class="text-center px-3">
											<form th:action="@{/cart/update}" method="post"
												class="d-flex align-items-center justify-content-center gap-2">
												<input type="hidden" name="cartItemID"
													th:value="${item.cartItemID}">
												<div class="input-group input-group-sm"
													style="width: 110px;">
													<button class="btn btn-outline-secondary btn-decrease"
														type="button">
														<i class="bi bi-dash"></i>
													</button>
													<input type="number"
														class="form-control text-center no-arrows" min="1"
														name="quantity" th:value="${item.quantity}" readonly>
													<button class="btn btn-outline-secondary btn-increase"
														type="button">
														<i class="bi bi-plus"></i>
													</button>
												</div>
												<button type="submit" class="btn btn-sm btn-outline-primary">
													Lưu</button>
											</form>
										</td>

										<!-- Tổng -->
										<td
											th:text="${#numbers.formatDecimal(item.itemTotal, 0, 'COMMA', 0, 'POINT')} + '₫'"></td>

										<!-- Xóa -->
										<td>
											<form th:action="@{/cart/remove}" method="post"
												onsubmit="return confirm('Xóa sản phẩm này khỏi giỏ hàng?')">
												<input type="hidden" name="cartItemID"
													th:value="${item.cartItemID}">
												<button class="btn btn-sm btn-outline-danger">
													<i class="bi bi-trash"></i>
												</button>
											</form>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- Tóm tắt đơn hàng -->
				<div class="col-lg-4">
					<div class="card shadow-sm border-0">
						<div class="card-body">
							<h5 class="fw-bold mb-3">
								<i class="bi bi-receipt-cutoff me-1"></i> Tóm tắt đơn hàng
							</h5>

							<div class="d-flex justify-content-between mb-2">
								<span>Tổng sản phẩm:</span> <strong th:text="${totalQuantity}"></strong>
							</div>
							<div class="d-flex justify-content-between mb-2">
								<span>Tổng tiền:</span> <strong
									th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></strong>
							</div>

							<hr>

							<a th:href="@{/checkout}" class="btn btn-primary w-100"> <i
								class="bi bi-credit-card me-2"></i>Thanh toán
							</a> <a th:href="@{/products}"
								class="btn btn-outline-secondary w-100 mt-2"> <i
								class="bi bi-arrow-left me-2"></i>Tiếp tục mua sắm
							</a>
						</div>
					</div>

					<form th:action="@{/cart/clear}" method="post" class="mt-3">
						<button type="submit" class="btn btn-outline-danger w-100">
							<i class="bi bi-trash3 me-2"></i>Xóa toàn bộ giỏ hàng
						</button>
					</form>
				</div>
			</div>
		</section>
	</div>

	<!-- Custom JavaScript -->
	<th:block layout:fragment="scripts">
		<script th:src="@{/js/user/cart.js}"></script>
	</th:block>
</body>
</html>
