<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{shipper/layout}">
<head>
<title>Dashboard - Shipper Panel</title>
<link rel="stylesheet" href="/css/shipper/dashboard.css">
</head>
<body>
	<h1 layout:fragment="page-title">Dashboard</h1>

	<div layout:fragment="content">
		<!-- Welcome -->
		<div class="mb-4">
			<h2>
				Xin ch√†o, <span
					th:text="${currentUser != null ? currentUser.username : 'Shipper'}">Shipper</span>!
				üöö
			</h2>
			<p class="text-muted">Qu·∫£n l√Ω ƒë∆°n ƒë∆∞·ª£c ph√¢n c√¥ng v√† theo d√µi hi·ªáu
				su·∫•t giao h√†ng.</p>
		</div>

		<!-- Statistics -->
		<div class="row g-4 mb-4">
			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #3b82f6, #60a5fa); color: #fff;">
						<i class="fas fa-user-check"></i>
					</div>
					<div class="stat-value" th:text="${assignedCount}">0</div>
					<div class="stat-label">ƒê∆∞·ª£c Ph√¢n C√¥ng</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #10b981, #34d399); color: #fff;">
						<i class="fas fa-truck-fast"></i>
					</div>
					<div class="stat-value" th:text="${inTransitCount}">0</div>
					<div class="stat-label">ƒêang Giao</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #7c3aed, #a78bfa); color: #fff;">
						<i class="fas fa-circle-check"></i>
					</div>
					<div class="stat-value" th:text="${deliveredCount}">0</div>
					<div class="stat-label">Giao Th√†nh C√¥ng</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #ef4444, #dc2626); color: #fff;">
						<i class="fas fa-triangle-exclamation"></i>
					</div>
					<div class="stat-value" th:text="${failedCount}">0</div>
					<div class="stat-label">Th·∫•t B·∫°i</div>
				</div>
			</div>

			<!-- COD c·∫ßn thu (C√°ch 2: T·ªïng gi√° tr·ªã t·∫•t c·∫£ ƒë∆°n tr·ª´ ƒë∆°n H·ª¶Y - set ·ªü controller) -->
			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #f59e0b, #fbbf24); color: #fff;">
						<i class="fas fa-money-bill-wave"></i>
					</div>
					<div class="stat-value"
						th:text="${#numbers.formatDecimal(codToCollect, 0, 'POINT', 0, 'POINT')}">0</div>
					<div class="stat-label">COD C·∫ßn Thu (‚Ç´)</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card">
					<div class="stat-icon"
						style="background: linear-gradient(135deg, #0ea5e9, #38bdf8); color: #fff;">
						<i class="fas fa-sack-dollar"></i>
					</div>
					<div class="stat-value"
						th:text="${#numbers.formatDecimal(codCollected, 0, 'POINT', 0, 'POINT')}">0</div>
					<div class="stat-label">COD ƒê√£ Thu (‚Ç´)</div>
				</div>
			</div>
		</div>

		<!-- Quick actions -->
		<div class="row g-4 mb-4">
			<div class="col-md-12">
				<div class="admin-table">
					<div class="table-header">
						<h5 class="mb-0">
							<i class="fas fa-bolt me-2"></i> Thao T√°c Nhanh
						</h5>
					</div>
					<div class="p-4">
						<div class="row g-3">
							<div class="col-md-3">
								<a href="/shipper/deliveries" class="btn btn-primary w-100">
									<i class="fas fa-list-check me-2"></i>Danh S√°ch ƒê∆°n ƒê∆∞·ª£c Giao
								</a>
							</div>
							<div class="col-md-3">
								<a href="/shipper/stats" class="btn btn-outline-primary w-100">
									<i class="fas fa-chart-line me-2"></i>Th·ªëng K√™ C√° Nh√¢n
								</a>
							</div>
							<div class="col-md-3">
								<a href="/shipper/help" class="btn btn-outline-primary w-100">
									<i class="fas fa-circle-info me-2"></i>H∆∞·ªõng D·∫´n Nhanh
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Recent orders for this shipper -->
		<div class="row g-4 mb-4">
			<div class="col-md-12">
				<div class="admin-table">
					<div
						class="table-header d-flex justify-content-between align-items-center">
						<h5 class="mb-0">
							<i class="fas fa-clock me-2"></i> ƒê∆°n Giao G·∫ßn ƒê√¢y
						</h5>
						<a href="/shipper/deliveries"
							class="btn btn-sm btn-outline-primary"> Xem T·∫•t C·∫£ <i
							class="fas fa-arrow-right ms-1"></i>
						</a>
					</div>

					<div class="table-responsive">
						<table class="table mb-0">
							<thead>
								<tr>
									<th>M√£ ƒê∆°n</th>
									<th>Kh√°ch H√†ng</th>
									<th>Tr·∫°ng Th√°i</th>
									<th>Ph√¢n C√¥ng</th>
									<th>Thanh To√°n</th>
									<th>Thao T√°c</th>
								</tr>
							</thead>
							<tbody>
								<!-- recentOrders l√† List<Order> -->
								<tr th:each="o : ${recentOrders}">
									<td><strong th:text="${o.orderID}">ORD-ID</strong></td>

									<td>
										<div th:text="${o.user != null ? o.user.username : 'N/A'}">T√™n
											KH</div> <small class="text-muted"
										th:text="${o.address != null ? o.address.phone : ''}">SƒêT</small>
									</td>

									<td><span class="badge"
										th:text="${OrderStatusHelper.getStatusLabel(o.status)}"
										th:classappend="' ' + ${OrderStatusHelper.getStatusBadgeClass(o.status)}">
									</span></td>

									<td><small
										th:text="${o.assignedAt != null ? #temporals.format(o.assignedAt,'dd/MM/yyyy HH:mm') : '-'}">-</small>
									</td>

									<td><span class="badge"
										th:text="${OrderStatusHelper.getPaymentStatusLabel(o.paymentStatus)}"
										th:classappend="' ' + ${OrderStatusHelper.getPaymentBadgeClass(o.paymentStatus)}">
									</span></td>

									<td>
										<!-- Route ƒë√∫ng: /shipper/deliveries/{orderId} --> <a
										th:href="@{/shipper/deliveries/{id}(id=${o.orderID})}"
										class="btn btn-sm btn-outline-primary"> <i
											class="fas fa-eye"></i> Xem
									</a>
									</td>
								</tr>

								<tr
									th:if="${recentOrders == null or #lists.isEmpty(recentOrders)}">
									<td colspan="6" class="text-center py-5"><i
										class="fas fa-truck-moving fa-3x text-muted mb-3"></i>
										<p class="text-muted">Ch∆∞a c√≥ ƒë∆°n giao n√†o</p></td>
								</tr>
							</tbody>
						</table>
					</div>

				</div>
			</div>
		</div>

	</div>
</body>
</html>
