<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
    <title th:text="${user.userID != null} ? 'Cập nhật Người Dùng' : 'Thêm Người Dùng'">User Form</title>
    <link rel="stylesheet" href="/css/admin/users.css">

    <style>
        .user-form-card {
            background: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 28px rgba(0, 0, 0, 0.12);
            max-width: 700px;
            margin: 40px auto;
        }
        .form-title { font-weight: 700; font-size: 25px; margin-bottom: 20px; text-align: center; }
        .avatar-preview {
            width: 120px; height: 120px; border-radius: 50%;
            object-fit: cover; border: 4px solid #e8e8e8;
            display: block; margin: 0 auto 15px;
        }
        .form-label { font-weight: 600; }
    </style>
</head>

<body>

<div layout:fragment="content">

    <div class="user-form-card">

        <h3 class="form-title"
            th:text="${user.userID != null} ? 'Cập Nhật Người Dùng' : 'Thêm Người Dùng'"></h3>

        <form th:object="${user}"
              th:action="@{/admin/users/save}"
              method="post" enctype="multipart/form-data">

            <!-- Hidden User ID -->
            <input type="hidden" th:if="${user.userID != null}" th:field="*{userID}">

            <!-- Avatar -->
            <div class="text-center">
                <img th:if="${user.avatar != null}"
                     th:src="@{${user.avatar}}"
                     class="avatar-preview">
            </div>

            <div class="mb-3">
                <label class="form-label">Ảnh đại diện</label>
                <input type="file" name="avatarFile" class="form-control" accept="image/*">
            </div>

            <!-- Username -->
            <div class="mb-3">
                <label class="form-label">Username</label>
                <input type="text" th:field="*{username}" class="form-control" placeholder="Nhập username" required>
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" th:field="*{email}" class="form-control" placeholder="Nhập email" required>
            </div>

            <!-- Password: chỉ yêu cầu khi tạo -->
            <div class="mb-3" th:if="${user.userID == null}">
                <label class="form-label">Mật khẩu</label>
                <input type="password" name="passwordRaw" class="form-control" placeholder="Nhập mật khẩu" required>
            </div>

            <!-- Role -->
            <div class="mb-3">
                <label class="form-label">Role</label>
                <select class="form-select" th:field="*{role.roleID}" required>
                    <option value="">-- Chọn role --</option>

                    <!-- Load từ database -->
                    <option th:each="r : ${roles}"
                            th:value="${r.roleID}"
                            th:text="${r.rolename}"
                            th:selected="${user.role != null and user.role.roleID == r.roleID}">
                    </option>
                </select>
            </div>

            <!-- Status -->
            <div class="mb-3">
                <label class="form-label">Trạng thái</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" th:field="*{status}" id="status1" value="1">
                    <label class="form-check-label" for="status1">Hoạt động</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" th:field="*{status}" id="status0" value="0">
                    <label class="form-check-label" for="status0">Bị khóa</label>
                </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-primary w-100 mt-3"
                    th:text="${user.userID != null} ? 'Cập nhật' : 'Thêm mới'"></button>

        </form>

    </div>
</div>

</body>
</html>