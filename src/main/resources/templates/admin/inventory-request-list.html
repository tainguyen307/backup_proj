<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{admin/layout}">
<head>
<title>Quản lý yêu cầu nhập kho</title>
    <link rel="stylesheet" href="/css/admin/inventory-request-list.css">

</head>
<body>
	<div layout:fragment="content">
		<div class="container-fluid mt-4">

			<!-- Alert messages -->
			<div th:if="${param.approved}"
				class="alert alert-success alert-dismissible fade show" role="alert">
				<i class="fas fa-check-circle"></i> Yêu cầu đã được duyệt thành
				công!
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div th:if="${param.rejected}"
				class="alert alert-danger alert-dismissible fade show" role="alert">
				<i class="fas fa-times-circle"></i> Yêu cầu đã bị từ chối!
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div class="card">
				<div class="card-header">
					<h4 class="mb-0">Quản lý yêu cầu nhập kho</h4>
				</div>
				<div class="card-body">

					<!-- Filter tabs -->
					<ul class="nav nav-tabs mb-3" id="statusFilter" role="tablist">
						<li class="nav-item" role="presentation">
							<button class="nav-link active" id="all-tab" data-bs-toggle="tab"
								data-bs-target="#all" type="button">
								Tất cả <span class="badge bg-secondary"
									th:text="${requests != null ? #lists.size(requests) : 0}">0</span>
							</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="pending-tab" data-bs-toggle="tab"
								data-bs-target="#pending" type="button">
								Chờ duyệt <span class="badge bg-warning text-dark"
									th:text="${requests != null ? #lists.size(requests.?[status?.name() == 'PENDING']) : 0}">0</span>
							</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="approved-tab" data-bs-toggle="tab"
								data-bs-target="#approved" type="button">
								Đã duyệt <span class="badge bg-success"
									th:text="${requests != null ? #lists.size(requests.?[status?.name() == 'APPROVED']) : 0}">0</span>
							</button>
						</li>
						<li class="nav-item" role="presentation">
							<button class="nav-link" id="rejected-tab" data-bs-toggle="tab"
								data-bs-target="#rejected" type="button">
								Từ chối <span class="badge bg-danger"
									th:text="${requests != null ? #lists.size(requests.?[status?.name() == 'REJECTED']) : 0}">0</span>
							</button>
						</li>
					</ul>

					<!-- Tab content -->
					<div class="tab-content" id="statusFilterContent">
						<!-- All requests -->
						<div class="tab-pane fade show active" id="all" role="tabpanel">
							<div
								th:replace="~{fragments/inventory-request-table :: requestTable(requests=${requests != null ? requests : {}})}"></div>
						</div>

						<!-- Pending requests -->
						<div class="tab-pane fade" id="pending" role="tabpanel">
							<div
								th:replace="~{fragments/inventory-request-table :: requestTable(requests=${requests != null ? requests.?[status?.name() == 'PENDING'] : {}})}"></div>
						</div>

						<!-- Approved requests -->
						<div class="tab-pane fade" id="approved" role="tabpanel">
							<div
								th:replace="~{fragments/inventory-request-table :: requestTable(requests=${requests != null ? requests.?[status?.name() == 'APPROVED'] : {}})}"></div>
						</div>

						<!-- Rejected requests -->
						<div class="tab-pane fade" id="rejected" role="tabpanel">
							<div
								th:replace="~{fragments/inventory-request-table :: requestTable(requests=${requests != null ? requests.?[status?.name() == 'REJECTED'] : {}})}"></div>
						</div>
					</div>

				</div>
			</div>
		</div>

		<!-- Modal xác nhận duyệt -->
		<div class="modal fade" id="approveModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Xác nhận duyệt yêu cầu</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<p>Bạn có chắc chắn muốn duyệt yêu cầu này?</p>
						<div class="alert alert-warning mb-3">
							<i class="fas fa-exclamation-triangle"></i> <strong>Lưu
								ý:</strong> Sau khi duyệt, vui lòng cập nhật inventory thủ công tại trang
							quản lý kho!
						</div>

						<div class="mb-3">
							<label for="approveNote" class="form-label">Ghi chú của
								admin (tùy chọn)</label>
							<textarea id="approveNote" name="adminNote" class="form-control"
								rows="2" placeholder="Nhập ghi chú nếu cần..."></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Hủy</button>
						<form id="approveForm" method="post" style="display: inline;">
							<button type="submit" class="btn btn-success">
								<i class="fas fa-check"></i> Xác nhận duyệt
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal xác nhận từ chối -->
		<div class="modal fade" id="rejectModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Xác nhận từ chối yêu cầu</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<p>Bạn có chắc chắn muốn từ chối yêu cầu này?</p>

						<div class="mb-3">
							<label for="rejectNote" class="form-label">Lý do từ chối
								(tùy chọn)</label>
							<textarea id="rejectNote" name="adminNote" class="form-control"
								rows="2" placeholder="Nhập lý do từ chối..."></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Hủy</button>
						<form id="rejectForm" method="post" style="display: inline;">
							<button type="submit" class="btn btn-danger">
								<i class="fas fa-times"></i> Xác nhận từ chối
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<script th:inline="javascript">
    function showApproveModal(requestId) {
        const form = document.getElementById('approveForm');
        form.action = '/admin/inventory-requests/' + requestId + '/approve';
        new bootstrap.Modal(document.getElementById('approveModal')).show();
    }

    function showRejectModal(requestId) {
        const form = document.getElementById('rejectForm');
        form.action = '/admin/inventory-requests/' + requestId + '/reject';
        new bootstrap.Modal(document.getElementById('rejectModal')).show();
    }
</script>

	</div>
</body>
</html>
