<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{vendor/layout}">
<head>
<title>Quản Lý Đơn Hàng - Vendor Panel</title>
    <link rel="stylesheet" href="/css/vendor/orders.css">

</head>
<body>
	<h1 layout:fragment="page-title">Quản Lý Đơn Hàng</h1>

	<div layout:fragment="content">
		<!-- Status Tabs -->
		<div class="mb-4">
			<ul class="nav nav-pills">
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'ALL' ? 'active' : ''}"
					th:href="@{/vendor/orders}"> Tất Cả <span
						class="badge bg-light text-dark ms-1"
						th:text="${statusCounts['ALL']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Chờ xác nhận' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=1)}"> Chờ Xác Nhận <span
						class="badge bg-warning text-dark ms-1"
						th:text="${statusCounts['PENDING']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đã xác nhận' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=2)}"> Đã Xác Nhận <span
						class="badge bg-info text-white ms-1"
						th:text="${statusCounts['CONFIRMED']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đang chuẩn bị' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=3)}"> Đang Chuẩn Bị <span
						class="badge bg-primary text-white ms-1"
						th:text="${statusCounts['PREPARING']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đã đóng gói' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=4)}"> Đã Đóng Gói <span
						class="badge bg-secondary text-white ms-1"
						th:text="${statusCounts['PACKED']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đang giao' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=5)}"> Đang Giao <span
						class="badge bg-primary text-white ms-1"
						th:text="${statusCounts['SHIPPED']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đã giao' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=6)}"> Đã Giao <span
						class="badge bg-success text-white ms-1"
						th:text="${statusCounts['DELIVERED']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Đã hủy' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=0)}"> Đã Hủy <span
						class="badge bg-danger text-white ms-1"
						th:text="${statusCounts['CANCELLED']}">0</span>
				</a></li>
				<li class="nav-item"><a class="nav-link"
					th:classappend="${currentStatus == 'Hoàn trả' ? 'active' : ''}"
					th:href="@{/vendor/orders(status=7)}"> Hoàn Trả <span
						class="badge bg-warning text-white ms-1"
						th:text="${statusCounts['RETURNED']}">0</span>
				</a></li>
			</ul>
		</div>

		<div class="admin-table mb-4">
    <div class="table-header">
        <h5 class="mb-0">
            <i class="fas fa-filter me-2"></i> Tìm Kiếm & Lọc
        </h5>
    </div>
    <div class="p-4">
        <form method="get" th:action="@{/vendor/orders}">
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label small text-muted">Mã đơn hàng</label>
                    <input type="text" class="form-control" name="search"
                        placeholder="Tìm theo mã đơn hàng..." th:value="${param.search}">
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-muted">Trạng thái</label>
                    <select class="form-select" name="status">
                        <option value="">Tất cả trạng thái</option>
                        <option value="1"
                            th:selected="${currentStatus == 'Chờ xác nhận'}">Chờ
                            xác nhận</option>
                        <option value="2"
                            th:selected="${currentStatus == 'Đã xác nhận'}">Đã xác
                            nhận</option>
                        <option value="3"
                            th:selected="${currentStatus == 'Đang chuẩn bị'}">Đang
                            chuẩn bị</option>
                        <option value="4"
                            th:selected="${currentStatus == 'Đã đóng gói'}">Đã
                            đóng gói</option>
                        <option value="5" th:selected="${currentStatus == 'Đang giao'}">Đang
                            giao</option>
                        <option value="6" th:selected="${currentStatus == 'Đã giao'}">Đã
                            giao</option>
                        <option value="0" th:selected="${currentStatus == 'Đã hủy'}">Đã
                            hủy</option>
                        <option value="7" th:selected="${currentStatus == 'Hoàn trả'}">Hoàn
                            trả</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label small text-muted">Từ ngày</label>
                    <input type="date" class="form-control" name="startDate"
                        th:value="${param.startDate}">
                </div>
                <div class="col-md-2">
                    <label class="form-label small text-muted">Đến ngày</label>
                    <input type="date" class="form-control" name="endDate"
                        th:value="${param.endDate}">
                </div>
                <div class="col-md-1 d-flex flex-column justify-content-end">
                    <button type="submit" class="btn btn-primary w-100 mb-2">
                        <i class="fas fa-search"></i>
                    </button>
                    <a th:href="@{/vendor/orders}" class="btn btn-sm btn-outline-secondary w-100">
                        <i class="fas fa-redo me-1"></i> Đặt lại
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

		<!-- Orders Table -->
		<div class="admin-table">
			<div
				class="table-header d-flex justify-content-between align-items-center">
				<h5 class="mb-0">
					<i class="fas fa-shopping-cart me-2"></i> Danh Sách Đơn Hàng
				</h5>
			</div>

			<div th:if="${message != null}"
				class="alert alert-success alert-dismissible fade show m-3"
				role="alert">
				<span th:text="${message}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div th:if="${error != null}"
				class="alert alert-danger alert-dismissible fade show m-3"
				role="alert">
				<span th:text="${error}"></span>
				<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
			</div>

			<div class="table-responsive">
				<table class="table mb-0">
					<thead>
						<tr>
							<th>Mã Đơn</th>
							<th>Khách Hàng</th>
							<th>Số Điện Thoại</th>
							<th>Tổng Tiền</th>
							<th>Trạng Thái</th>
							<th>Thanh Toán</th>
							<th>Ngày Đặt</th>
							<th>Thao Tác</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order : ${orders}">
							<td data-label="Mã Đơn"><strong th:text="${order.orderID}">ORD123</strong>
							</td>
							<td data-label="Khách Hàng">
								<div th:text="${order.user.username}">Customer Name</div> <small
								class="text-muted" th:text="${order.user.email}">Email</small>
							</td>
							<td data-label="Số Điện Thoại"><small
								th:text="${order.address.phone}">Phone</small></td>
							<td data-label="Tổng Tiền"><strong
								th:text="${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' ₫'">0
									₫</strong></td>
							<td data-label="Trạng Thái"><span class="badge"
								th:classappend="${OrderStatusHelper.getStatusBadgeClass(order.status)}"
								th:text="${OrderStatusHelper.getStatusLabel(order.status)}">
									Status </span></td>
							<td data-label="Thanh Toán"><span class="badge"
								th:classappend="${OrderStatusHelper.getPaymentBadgeClass(order.paymentStatus)}"
								th:text="${OrderStatusHelper.getPaymentStatusLabel(order.paymentStatus)}">
									Payment Status </span></td>
							<td data-label="Ngày Đặt"><small
								th:text="${#temporals.format(order.createAt, 'dd/MM/yyyy HH:mm')}">Date</small>
							</td>
							<td data-label="Thao Tác"><a
								th:href="@{/vendor/orders/{id}(id=${order.orderID})}"
								class="btn btn-sm btn-outline-primary"> <i
									class="fas fa-eye"></i> Chi Tiết
							</a></td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- Pagination -->
			<div th:if="${page.totalPages > 1}"
				class="d-flex justify-content-between align-items-center p-3 border-top">
				<div>
					<small class="text-muted"> Hiển thị <strong
						th:text="${page.number * page.size + 1}">1</strong> - <strong
						th:text="${T(java.lang.Math).min((page.number + 1) * page.size, page.totalElements)}">10</strong>
						trong tổng số <strong th:text="${page.totalElements}">100</strong>
						đơn hàng
					</small>
				</div>

				<nav>
					<ul class="pagination pagination-sm mb-0">
						<li class="page-item"
							th:classappend="${page.first ? 'disabled' : ''}"><a
							class="page-link"
							th:href="@{/vendor/orders(page=0, size=${page.size}, status=${currentStatus != 'ALL' ? OrderStatusHelper.getStatusValue(currentStatus) : null}, search=${param.search}, startDate=${param.startDate}, endDate=${param.endDate})}">
								Đầu </a></li>
						<li class="page-item"
							th:classappend="${page.first ? 'disabled' : ''}"><a
							class="page-link"
							th:href="@{/vendor/orders(page=${page.number - 1}, size=${page.size}, status=${currentStatus != 'ALL' ? OrderStatusHelper.getStatusValue(currentStatus) : null}, search=${param.search}, startDate=${param.startDate}, endDate=${param.endDate})}">
								Trước </a></li>

						<li class="page-item"
							th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
							th:if="${i >= page.number - 2 && i <= page.number + 2}"
							th:classappend="${i == page.number ? 'active' : ''}"><a
							class="page-link"
							th:href="@{/vendor/orders(page=${i}, size=${page.size}, status=${currentStatus != 'ALL' ? OrderStatusHelper.getStatusValue(currentStatus) : null}, search=${param.search}, startDate=${param.startDate}, endDate=${param.endDate})}"
							th:text="${i + 1}">1</a></li>

						<li class="page-item"
							th:classappend="${page.last ? 'disabled' : ''}"><a
							class="page-link"
							th:href="@{/vendor/orders(page=${page.number + 1}, size=${page.size}, status=${currentStatus != 'ALL' ? OrderStatusHelper.getStatusValue(currentStatus) : null}, search=${param.search}, startDate=${param.startDate}, endDate=${param.endDate})}">
								Sau </a></li>
						<li class="page-item"
							th:classappend="${page.last ? 'disabled' : ''}"><a
							class="page-link"
							th:href="@{/vendor/orders(page=${page.totalPages - 1}, size=${page.size}, status=${currentStatus != 'ALL' ? OrderStatusHelper.getStatusValue(currentStatus) : null}, search=${param.search}, startDate=${param.startDate}, endDate=${param.endDate})}">
								Cuối </a></li>
					</ul>
				</nav>
			</div>
		</div>
	</div>
</body>
</html>